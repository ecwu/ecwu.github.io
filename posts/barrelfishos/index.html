<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		 
			
  
    <meta name="twitter:card" content="summary"/>
    
      <meta name="twitter:image" content="https://ecwuuuuu.com/images/avatar.png" />
    
  
  
  <meta name="twitter:title" content="Barrelfish OS 和多内核操作系统"/>
  <meta name="twitter:description" content="Barrelfish OS and Multi-kernel Operating System"/>
  
    <meta name="twitter:site" content="@your_twitter_id"/>
  
  
  
  
    <meta name="twitter:creator" content="@Zhenghao Wu"/>
  



		
		<meta name="author" content="Zhenghao Wu">
		<meta name="description" content="My website &amp; blog">
		<meta name="generator" content="Hugo 0.50" />
		<title>Barrelfish OS 和多内核操作系统 &middot; ECWU - Zhenghao Wu</title>
		<link rel="shortcut icon" href="https://ecwuuuuu.com/images/favicon.ico">
		<link rel="stylesheet" href="https://ecwuuuuu.com/css/style.css">
		<link rel="stylesheet" href="https://ecwuuuuu.com/css/highlight.css">

		
		<link rel="stylesheet" href="https://ecwuuuuu.com/css/font-awesome.min.css">
		

		
		<link href="https://ecwuuuuu.com/index.xml" rel="alternate" type="application/rss+xml" title="ECWU - Zhenghao Wu" />
		

		
		<style type="text/css">
		#map {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 200px;
            height: 100%;
            z-index: 100;
        }
        @media only screen and (max-width: 1026px) {
            #map {
                display: none;
            }
        }
		</style>
	</head>

    <body>
       <nav class="main-nav">
	
	
		<a href='https://ecwuuuuu.com/'> <span class="arrow">←</span>Home</a>
	
	<a href='https://ecwuuuuu.com/posts'>Archive</a>
	<a href='https://ecwuuuuu.com/tags'>Tags</a>
	<a href='https://ecwuuuuu.com/about'>About</a>

	

	
	<a class="cta" href="https://ecwuuuuu.com/index.xml">RSS</a>
	
</nav>

      <canvas id="map"></canvas>
        <section id="wrapper" class="post">
            <article>
                <header>
                    <h1>
                        Barrelfish OS 和多内核操作系统
                    </h1>
                    <h2 class="headline">
                    Jan 9, 2019 00:00
                    · 1716 words
                    · 4 minute read
                      <span class="tags">
                      
                      
                          
                              <a href="https://ecwuuuuu.com/tags/os">OS</a>
                          
                              <a href="https://ecwuuuuu.com/tags/barrelfish-os">Barrelfish OS</a>
                          
                              <a href="https://ecwuuuuu.com/tags/eth-zurich">ETH Zurich</a>
                          
                              <a href="https://ecwuuuuu.com/tags/uic">UIC</a>
                          
                              <a href="https://ecwuuuuu.com/tags/computer-science">Computer Science</a>
                          
                      
                      
                      </span>
                    </h2>
                </header>
                
                  
                    <div id="toc">
                      <nav id="TableOfContents">
<ul>
<li><a href="#什么是-barrelfish-os">什么是 Barrelfish OS</a>
<ul>
<li><a href="#背景">背景</a></li>
<li><a href="#现状">现状</a></li>
<li><a href="#特点">特点</a></li>
</ul></li>
<li><a href="#多内核架构-multikernel-architecture">多内核架构（Multikernel Architecture）</a></li>
<li><a href="#程序在-barrelfish-os-上运行">程序在 Barrelfish OS 上运行</a></li>
<li><a href="#内存">内存</a></li>
<li><a href="#安装-barrelfish-os">安装 Barrelfish OS</a></li>
<li><a href="#总结">总结</a></li>
<li><a href="#reference-extra-materials">Reference / Extra materials</a></li>
</ul>
</nav>
                    </div>
                  
                
                <section id="post-body">
                    <p>大三的上学期有一门专业课叫操作系统（Operating System），它的课程小组项目是对某个操作系统进行研究。我们组抽到了 Barrelfish Operating System。</p>

<p></p>

<p><img src="/barrelfish-logo.jpg" alt="Barrelfish OS Logo" /></p>

<p>因为这是一个试验性操作系统，而且提出了许多全新的概念。因此虽然官方网站上给出了许多文档，我们依然花了许多时间来理解这个系统的架构。</p>

<h1 id="什么是-barrelfish-os">什么是 Barrelfish OS</h1>

<h2 id="背景">背景</h2>

<p>Barrelfish OS 是由苏黎世联邦理工大学系统小组（ETH Zurich Systems Group）与微软剑桥研究院（Microsoft Research Cambridge）于 2007 年开始研究开发的实验操作系统（这种操作系统主要被研究者用于实践提出的新概念或想法）。</p>

<h2 id="现状">现状</h2>

<p>系统到目前为止依然有更新，最新的一次更新是在 2018 年 10 月 4 日发布的版本（添加了对 Ubuntu 18.04 LTS 作为构建环境的支持）。</p>

<p>虽然经过了多年的开发，这个系统远达不到可用的地步。运行需要 QEMU，而且非常不稳定。</p>

<blockquote>
<p>我构建安装的 Barrelfish OS，运行提供的 <code>demo</code> 演示程序就会崩溃 🤨（当然也可能跟我迷醉的运行方式有关：在 macOS 上通过 Teamviewer 远程至一个 Windows 台式机上 VirtualBox 软件上的 Ubuntu 18.04 虚拟机；在虚拟机中运行 QEMU 模拟的 Barrelfish OS）</p>
</blockquote>

<h2 id="特点">特点</h2>

<p>Barrelfish OS 最大的特点就是多内核（Multikernel）。研究者认为目前的操作系统不是为拥有大量运算核心的计算机而设计的，同时多核心处理器是未来运算芯片的趋势（因为提高时钟速度会造成更大的功耗和发热）。Barrelfish OS 就是为了更好的利用多核芯处理器计算机而出现的。虽然有些国内的媒体听见风就是雨以为这个微软参与的项目会诞生一个替代 Windows 的产品，但需要注意的是，Barrelfish OS 并不是 Windows 的替代品，它只是为了实践提出的新概念或想法，这也正是实验操作系统的意义。</p>

<h1 id="多内核架构-multikernel-architecture">多内核架构（Multikernel Architecture）</h1>

<p>Barrelfish OS 研究人员面临的主要挑战是可扩展性，包括硬件核心的拓展和异构硬件（如何将 ARM 的芯片和 Intel 的芯片一起管理）的拓展。</p>

<p>研究人员提出了多内核（Multikernel）的概念。与传统的一个内核负责管理调度所有的核心不同，多内核是在每一个核心上都运行一个独立的内核，该内核只负责调度这一核内的资源，不同的内核之间再显式的进行通信（不直接进行通信）。</p>

<p>Barrelfish OS 上的内核被称为 CPU Driver (核心处理器驱动)。它是单线程且不可被抢占的程序，会承担调度程序在CPU上运行的行为。</p>

<h1 id="程序在-barrelfish-os-上运行">程序在 Barrelfish OS 上运行</h1>

<p>程序（Program）在传统的操作系统上运行是通过进程（Process）的形式。而 Barrelfish OS 是通过 Dispatcher 的形式。</p>

<p>一个程序运行后以一个 Dispatcher 的形式运行在 CPU 中，如果一个程序有多个进程同时运行，那么则会有多个 Dispatcher 运行在多个 CPU 上。Dispatcher 要做的是指定一个线程并让该线程运行在 CPU 上。</p>

<p>多个 Dispatcher 形成一个 Domain（域）的概念，进而会涉及到域之间通信的问题（类似程序间通信，用的是一种类似 RPC 的通信方法），但是这篇文章中不会涉及这个内容。</p>

<p>因为核心之间不能直接进行通信，所以 Monitor 被引入了（这个 Monitor 与同步问题中的管程不同）。CPU Driver 将通过 Monitor 进行核之间的信息交流。</p>

<p>总结一下，CPU Driver 会调度一个 Dispatcher 运行，Dispatcher 再调度一个线程来运行。Dispatcher 和线程都可以被抢断。</p>

<h1 id="内存">内存</h1>

<blockquote>
<p>我们没有将内存研究的非常深，这里只根据我的理解，简单的介绍。</p>
</blockquote>

<p>Barrelfish OS 从 <a href="https://sel4.systems">seL4</a> 引入了 Capability。因为运行在 CPU 上的程序不能直接访问内存，所以它们通过访问 Capabilities Reference 并通过逐层的 CNode 索引，最后找到 Capability。最后再通过 Capability 找到最终的物理内存地址。</p>

<p>Capability 的引入有一定的原因是为了安全的内存访问。</p>

<h1 id="安装-barrelfish-os">安装 Barrelfish OS</h1>

<p>我是在一个 Ubuntu 18.04 的虚拟机上构建的 Barrelfish OS，构建时依照了<a href="http://wiki.barrelfish.org/Getting_Started">官方维基</a>内提供的步骤，不要遗漏一些包文件就不会在构建时遇到问题。但运行时是比较容易遇到问题的。</p>

<p>最后在 <a href="https://www.github.com/lmy441900">@lmy441900</a> 和 <a href="https://www.github.com/DRJ31">@DRJ31</a> 的帮助下，我们安装了 QEMU，并通过 QEMU 模拟了两核心的电脑运行 Barrelfish OS。</p>

<h1 id="总结">总结</h1>

<p>这篇文章并不是对 Barrelfish OS 的完整概述，只是我在学期结束后的假期里，对这个小组作业的小小回顾。</p>

<p>就像菲利普教授说的 &ldquo;Barrelfish is fun.&ldquo;， 这个系统确实非常的有趣，但是同时也因为多内核架构，系统引入非常多的新想法和解决方案，让初学者很难快速理解整个系统的架构。</p>

<p>Barrelfish 是有意义的，它也许不能成为下一个 Windows，但是能成为未来多核操作系统的研究平台，现有的研究成果也能被使用在未来的操作系统中。</p>

<h1 id="reference-extra-materials">Reference / Extra materials</h1>

<ul>
<li><a href="http://www.barrelfish.org/index.html">Barrelfish Operating System</a></li>
<li><a href="http://www.barrelfish.org/publications/barrelfish_sosp09.pdf">The Multikernel: A new OS architecture for scalable multicore systems</a></li>
<li><a href="https://www.microsoft.com/en-us/research/blog/barrelfish-exploring-multicore-os/">Barrelfish: Exploring a Multicore OS</a></li>
</ul>
                </section>
            </article>

            
                <a class="twitter" href="https://twitter.com/intent/tweet?text=https%3a%2f%2fecwuuuuu.com%2fposts%2fbarrelfishos%2f - Barrelfish%20OS%20%e5%92%8c%e5%a4%9a%e5%86%85%e6%a0%b8%e6%93%8d%e4%bd%9c%e7%b3%bb%e7%bb%9f by @your_twitter_id"><span class="icon-twitter"> tweet</span></a>

<a class="facebook" href="#" onclick="
    window.open(
      'https://www.facebook.com/sharer/sharer.php?u='+encodeURIComponent(location.href),
      'facebook-share-dialog',
      'width=626,height=436');
    return false;"><span class="icon-facebook-rect"> Share</span>
</a>

            

            

            <div id="vcomments" style="margin-top: 1.5rem;"></div>

            

            <footer id="footer">
    
        <div id="social">

	
	
    <a class="symbol" href="https://www.github.com/ecwu">
        <i class="fa fa-github-square"></i>
    </a>
    


</div>

    
    <p class="small">
    
       © Copyright 2019 - Zhenghao Wu
    
    </p>
    <p class="small"><a href="http://www.miitbeian.gov.cn/publish/query/indexFirst.action">粤 ICP 备 17015575 号 - 1</a></p>

</footer>

        </section>

        <script src="https://ecwuuuuu.com/js/jquery-3.3.1.min.js"></script>
<script src="https://ecwuuuuu.com/js/main.js"></script>
<script src="https://ecwuuuuu.com/js/highlight.min.js"></script>
<script src="https://ecwuuuuu.com/js/pagemap-0.4.0.min.js"></script>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine/dist/Valine.min.js'></script>
<script>
  pagemap(document.querySelector('#map'));
</script>
<script>hljs.initHighlightingOnLoad();</script>







<script>
    new Valine({
        el: '#vcomments',
        appId: 'uDGEO1UU2Rrqucepbf781tOG-gzGzoHsz',
        appKey: 'ituTB2E1U842WUXpIGToDBOc'
    })
</script>
    </body>
</html>
